# UserUI - Localization Implementation 

## Overview
Design and implement app-wide localization for FinDogAI using Ionic UI and ngx-translate. Provide a Language Selector component, persist user choice in localStorage, preload translations, and ensure offline-friendly behavior.

## Dependencies & Prerequisites
- Framework: Angular 20, Ionic standalone components
- i18n: `@ngx-translate/core`, `@ngx-translate/http-loader`
- Asset location: `public/i18n/{lang}.json` (e.g., en.json, cs.json)
- Service Worker enabled for caching JSON assets (PWA)

## Translation Files: Structure & Management
- Location: `public/i18n/`
- File per locale, flat or nested keys
- Naming: ISO 639-1 (en, cs, es, …)
- Versioning: update keys atomically; avoid breaking changes
- Linting: optional key consistency check (script)

Recommended key groups:
- auth.* (labels/errors for signin/signup)
- landing.* (hero, CTAs)
- onboarding.* (wizard steps)
- common.* (buttons like Save/Cancel/Retry)

## LanguageSelectorComponent (Ionic)
- UI: IonSelect + IonSelectOption (or ActionSheet for mobile-first UX)
- Accessibility: labels, large touch targets
- Behavior:
  - Read initial language: localStorage.lang || browser language || 'en'
  - Call TranslateService.use(lang) and persist to localStorage
  - Emit event for analytics or future use
  - Optional: show available locales (from config or by scanning assets at build-time)

Implementation notes:
- Create LanguageService wrapping TranslateService
  - Methods: getLang(), setLang(lang), lang$ (BehaviorSubject)
  - Persist in localStorage
  - Initialize early in app bootstrap (APP_INITIALIZER)

## Integration with ngx-translate
- Configure in bootstrap (main.ts) with `provideTranslateService` + `provideTranslateHttpLoader`
- Fallback language: 'en'
- Default/initial language: detected or last persisted
- Lazy-loading: HTTP loader fetches `/assets/i18n/{lang}.json`

## Persistence of Language Preferences
- Key: `lang`
- Value: locale string (e.g., 'en')
- On app start: if key exists, set TranslateService.use(value)
- On change: update key and broadcast via LanguageService

## Offline Considerations
- Ensure `public/i18n/*.json` cached by Service Worker (ngsw-config.json)
- Graceful fallback if a language file fails: keep previous language and show toast
- Small JSONs for quick load; avoid overly deep nesting

## Implementation Steps (Prioritized)
1) Configure ngx-translate in bootstrap with HTTP loader and fallback
2) Implement LanguageService with persistence and observable state
3) Build LanguageSelectorComponent using Ionic; wire to LanguageService
4) Add selector to Landing header and optionally in Settings/Profile
5) Mark up pages with i18n keys; migrate any hard-coded strings
6) Cache i18n assets via SW and verify offline behavior
7) Add E2E and unit tests

## Acceptance Criteria
- Language can be switched via the selector and persists across reloads
- All Landing/Auth/Onboarding visible texts use i18n keys
- Fallback language works when key is missing
- Offline: translations still load after first visit
- Accessibility: selector is screen-reader friendly

## E2E Test Specification
- Switch language to CS, reload: UI remains CS
- Go offline after first load: app still shows translations
- Missing key scenario: fallback language shown for that key
- Selector keyboard/VO navigation works

## Risk Mitigation
- Missing/mismatched keys → add CI script to validate key presence across locales
- Large i18n bundles → split by domain (landing, auth, onboarding) if needed later
- Offline caching misses new language → SW version bump strategy; instruct users to refresh

